<!doctype html>
<head>
  <title>Plates browser tests</title>
  <link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-git.css" />
  <script src="http://code.jquery.com/qunit/qunit-git.js"></script>
  <script src="http://bestiejs.github.com/json3/lib/json3.js"></script>
  <script src="../lib/plates.js"></script>
</head>
<body>
<div id="qunit"></div>

<script type="test/fixture" id="partial-1.html">
<strong>strong</strong> plates

</script>
<script type="test/fixture" id="test-1.html">
<div id='key'></div>
</script>
<script type="test/fixture" id="test-1.json">
{
  "key": "value"
}

</script>
<script type="test/fixture" id="test-1.out">
<div id='key'>value</div>
</script>
<script type="test/fixture" id="test-10.html">
<br><img class="logo"><input name="first_name"/><input name="last_name" />
</script>
<script type="test/fixture" id="test-10.json">
{
  "url": "/some/image.png",
  "fname": "Raul",
  "lname": "Julia"
}
</script>
<script type="test/fixture" id="test-10.out">
<br><img class="logo" src="/some/image.png"><input name="first_name" value="Raul"/><input name="last_name" value="Julia" />
</script>
<script type="test/fixture" id="test-11.html">
<input type="hidden" name="method" value="" /><input type="hidden" name="id" value="" />

</script>
<script type="test/fixture" id="test-11.json">
{
  "method": "DELETE",
  "id": 7
}

</script>
<script type="test/fixture" id="test-11.out">
<input type="hidden" name="method" value="DELETE" /><input type="hidden" name="id" value="7" />

</script>
<script type="test/fixture" id="test-12.html">
<ul><li class="name"><span class="first"></span>:<span class="middle"></span><span class="last"></span></li></ul>

</script>
<script type="test/fixture" id="test-12.json">
{
  "name": [
    {
      "first"  : "John",
      "middle" : "C",
      "last"   : "Smith"
    },
    {
      "first"  : "Jane",
      "middle" : "A",
      "last"   : "Doe"
    }
  ]
}

</script>
<script type="test/fixture" id="test-12.out">
<ul><li class="name"><span class="first">John</span>:<span class="middle">C</span><span class="last">Smith</span></li><li class="name"><span class="first">Jane</span>:<span class="middle">A</span><span class="last">Doe</span></li></ul>

</script>
<script type="test/fixture" id="test-13.html">
<a href="aA1-_:/&#1235; "></a>
</script>
<script type="test/fixture" id="test-13.json">
{
  "test": "test"
}
</script>
<script type="test/fixture" id="test-13.out">
<a href="test"></a>
</script>
<script type="test/fixture" id="test-14.html">
<table>
  <tr class="names">
    <td class="first"></td>
    <td class="last"></td>
  </tr>
</table>

</script>
<script type="test/fixture" id="test-14.json">
{
  "names" : [
    {
      "first"  : "John",

      "last"   : "Smith"
    },
    {
      "first"  : "Jane",
      "last"   : "Doe"
    }
  ]
}

</script>
<script type="test/fixture" id="test-14.out">
<table>
  <tr class="names">
    <td class="first">John</td>
    <td class="last">Smith</td>
  </tr><tr class="names">
    <td class="first">Jane</td>
    <td class="last">Doe</td>
  </tr>
</table>

</script>
<script type="test/fixture" id="test-15.html">
<a href="placeholder">Link</a>
<ul>
  <li class="names">
    <span class="first"></span>
    <span class="middle"></span>
    <span class="last"></span>
  </li>
</ul>

</script>
<script type="test/fixture" id="test-15.json">
{
  "link"  : "/foobar",
  "names" : [
    {
      "first"  : "John",
      "middle" : "C",
      "last"   : "Smith"
    },
    {
      "first"  : "Jane",
      "middle" : "A",
      "last"   : "Doe"
    }
  ]
}

</script>
<script type="test/fixture" id="test-15.out">
<a href="/foobar">Link</a>
<ul>
  <li class="names">
    <span class="first">John</span>
    <span class="middle">C</span>
    <span class="last">Smith</span>
  </li><li class="names">
    <span class="first">Jane</span>
    <span class="middle">A</span>
    <span class="last">Doe</span>
  </li>
</ul>

</script>
<script type="test/fixture" id="test-16.html">
<b>Flatiron Components</b>
<br/>
<ul>
  <li class='components'></li>
</ul>

</script>
<script type="test/fixture" id="test-16.json">
{
  "components": [
    "Union",
    "Director",
    "Broadway",
    "Plates",
    "Resourceful"
  ]
}

</script>
<script type="test/fixture" id="test-16.out">
<b>Flatiron Components</b>
<br/>
<ul>
  <li class='components'>Union</li><li class='components'>Director</li><li class='components'>Broadway</li><li class='components'>Plates</li><li class='components'>Resourceful</li>
</ul>

</script>
<script type="test/fixture" id="test-17.html">
<ul>
  <li class="organizations">
    <h3 class="name"></h3>
    <ul>
      <li class="staff">
        <table>
          <tr class="name">
            <td class="first"></td>
            <td class="last"></td>
          </tr>
        </table>
      </li>
    </ul>
  </li>
</ul>

</script>
<script type="test/fixture" id="test-17.json">
{
  "organizations" : [
    {
      "name": "DotOrg",
      "staff": [
        {
          "name": {
            "first": "Dot",
            "last" : "Matrix"
          }
        },
        {
          "name": {
            "first": "Serious",
            "last" : "Business"
          }
        }
      ]
    },
    {
      "name": "FooBar",
      "staff": [
        {
          "name": {
            "first": "Foo",
            "last" : "Bar"
          }
        },
        {
          "name": {
            "first": "Baz",
            "last" : "Bitsom"
          }
        }
      ]
    }
  ]
}

</script>
<script type="test/fixture" id="test-17.out">
<ul>
  <li class="organizations">
    <h3 class="name">DotOrg</h3>
    <ul>
      <li class="staff">
        <table>
          <tr class="name">
            <td class="first">Dot</td>
            <td class="last">Matrix</td>
          </tr>
        </table>
      </li><li class="staff">
        <table>
          <tr class="name">
            <td class="first">Serious</td>
            <td class="last">Business</td>
          </tr>
        </table>
      </li>
    </ul>
  </li><li class="organizations">
    <h3 class="name">FooBar</h3>
    <ul>
      <li class="staff">
        <table>
          <tr class="name">
            <td class="first">Foo</td>
            <td class="last">Bar</td>
          </tr>
        </table>
      </li><li class="staff">
        <table>
          <tr class="name">
            <td class="first">Baz</td>
            <td class="last">Bitsom</td>
          </tr>
        </table>
      </li>
    </ul>
  </li>
</ul>

</script>
<script type="test/fixture" id="test-18.html">
<span class="username"></span>
<span class="login name"></span>

</script>
<script type="test/fixture" id="test-18.json">
{
  "username": "lord thingy",
  "name": "Tom Marvolo Riddle"
}

</script>
<script type="test/fixture" id="test-18.out">
<span class="username">lord thingy</span>
<span class="login name">Tom Marvolo Riddle</span>

</script>
<script type="test/fixture" id="test-19.html">
<a href="bar/bla">test</a>
</script>
<script type="test/fixture" id="test-19.json">
{}
</script>
<script type="test/fixture" id="test-19.out">
<a href="bazz/bla">test</a>
</script>
<script type="test/fixture" id="test-2.html">
<!-- foo --><div id="key1"><div id="key2"></div><img src="/"/></div>
</script>
<script type="test/fixture" id="test-2.json">
{
  "key2": "value2"
}
</script>
<script type="test/fixture" id="test-2.out">
<!-- foo --><div id="key1"><div id="key2">value2</div><img src="/"/></div>
</script>
<script type="test/fixture" id="test-20.html">
<a href="bar/bla"></a>
</script>
<script type="test/fixture" id="test-20.json">
{ "test": "test" }
</script>
<script type="test/fixture" id="test-20.out">
<a href="test/bla"></a>
</script>
<script type="test/fixture" id="test-21.html">
<div id="key"><div class="removed">Hello world</div></div>

</script>
<script type="test/fixture" id="test-21.json">
{}

</script>
<script type="test/fixture" id="test-21.out">
<div id="key"></div>

</script>
<script type="test/fixture" id="test-22.html">
<div id="key"><input type="email" value="testing" /></div>

</script>
<script type="test/fixture" id="test-22.json">
{}

</script>
<script type="test/fixture" id="test-22.out">
<div id="key"></div>

</script>
<script type="test/fixture" id="test-23.html">
<div id="key"><input type="email" value="testing"></div>

</script>
<script type="test/fixture" id="test-23.json">
{}

</script>
<script type="test/fixture" id="test-23.out">
<div id="key"></div>

</script>
<script type="test/fixture" id="test-24.html">
<div class="insert"></div>

</script>
<script type="test/fixture" id="test-24.json">
{}

</script>
<script type="test/fixture" id="test-24.out">
<div class="insert"><div class="trolling"></div></div>

</script>
<script type="test/fixture" id="test-25.html">
<div class="insert"></div>

</script>
<script type="test/fixture" id="test-25.json">
{}

</script>
<script type="test/fixture" id="test-25.out">
<div class="insert"><div class="trolling">moo</div></div>

</script>
<script type="test/fixture" id="test-26.html">
<div class="insert"></div>

</script>
<script type="test/fixture" id="test-26.json">
{
  "partial": {
    "boink": "moo"
  }
}

</script>
<script type="test/fixture" id="test-26.out">
<div class="insert"><div class="trolling">moo</div></div>

</script>
<script type="test/fixture" id="test-27.html">
<div class="insert"></div>

</script>
<script type="test/fixture" id="test-27.json">
{}

</script>
<script type="test/fixture" id="test-27.out">
<div class="insert">
<strong>strong</strong> plates

</div>

</script>
<script type="test/fixture" id="test-28.html">
<div class="insert"></div>

</script>
<script type="test/fixture" id="test-28.json">
{}

</script>
<script type="test/fixture" id="test-28.out">
<div class="insert">
<strong>strong</strong> plates


<strong>strong</strong> plates


<strong>strong</strong> plates

</div>

</script>
<script type="test/fixture" id="test-29.html">
<div></div>

</script>
<script type="test/fixture" id="test-29.json">
{ "foo": "bar" }

</script>
<script type="test/fixture" id="test-29.out">
<div>bar</div>

</script>
<script type="test/fixture" id="test-3.html">
<div id="key1" style="visible: foobar > 1"><!-- foo --><div id="key2"></div><img src="/"/></div>

</script>
<script type="test/fixture" id="test-3.json">
{
  "key1": "value1"
}
</script>
<script type="test/fixture" id="test-3.out">
<div id="key1" style="visible: foobar > 1">value1</div>

</script>
<script type="test/fixture" id="test-30.html">
<div class="transformation"></div>

</script>
<script type="test/fixture" id="test-30.json">
{ "uppercase": "UPPERCASED" }

</script>
<script type="test/fixture" id="test-30.out">
<div class="transformation">uppercased</div>

</script>
<script type="test/fixture" id="test-31.html">
<a class="author" href=""></a>
</script>
<script type="test/fixture" id="test-31.json">
{
  "name": "The Name",
  "url": "//the.url.com/abc"
}
</script>
<script type="test/fixture" id="test-31.out">
<a class="author" href="//the.url.com/abc">The Name</a>
</script>
<script type="test/fixture" id="test-32.html">
<a class="author" href=""></a>
</script>
<script type="test/fixture" id="test-32.json">
{
  "name": "The Name",
  "url": "//the.url.com/abc"
}
</script>
<script type="test/fixture" id="test-32.out">
<a class="author" href="//the.url.com/abc">The Name</a>
</script>
<script type="test/fixture" id="test-34.html">
<a class="author" href=""></a>
</script>
<script type="test/fixture" id="test-34.json">
{
  "class": "class1 author",
  "url": "//the.url.com/abc"
}
</script>
<script type="test/fixture" id="test-34.out">
<a class="class1 author" href="//the.url.com/abc"></a>
</script>
<script type="test/fixture" id="test-35.html">
<a class="author" href=""></a>
</script>
<script type="test/fixture" id="test-35.json">
{
  "name": "The Name",
  "class": "class1 author",
  "url": "//the.url.com/abc"
}
</script>
<script type="test/fixture" id="test-35.out">
<a class="class1 author" href="//the.url.com/abc">The Name</a>
</script>
<script type="test/fixture" id="test-36.html">
<div class="authors">
  <ul>
    <li class="author">
      <h2 class="title"></h2>
      <a class="name" href="">The author name is<span class="inner"></span></a>
    </li>
  </ul>
</div>
</script>
<script type="test/fixture" id="test-36.json">
{
  "author":
    { "name": {"inner": "Author 1"}, "title": "Title 1", "link": "//1" }
}
</script>
<script type="test/fixture" id="test-36.out">
<div class="authors">
  <ul>
    <li class="author">
      <h2 class="title">Title 1</h2>
      <a class="name" href="//1">The author name is<span class="inner">Author 1</span></a>
    </li>
  </ul>
</div>
</script>
<script type="test/fixture" id="test-37.html">
<div class="authors">
  <ul>
    <li class="author">
      <h2 class="title"></h2>
      <a class="name" href="">The author name is<span class="inner"></span></a>
    </li>
  </ul>
</div>
</script>
<script type="test/fixture" id="test-37.json">
{
  "author": [
    { "name": {"inner": "Author 1"}, "title": "Title 1", "link": "//1" },
    { "name": {"inner": "Author 2"}, "title": "Title 2", "link": "//2" },
    { "name": {"inner": "Author 3"}, "title": "Title 3", "link": "//3" }
  ]
}
</script>
<script type="test/fixture" id="test-37.out">
<div class="authors">
  <ul>
    <li class="author">
      <h2 class="title">Title 1</h2>
      <a class="name" href="//1">The author name is<span class="inner">Author 1</span></a>
    </li><li class="author">
      <h2 class="title">Title 2</h2>
      <a class="name" href="//2">The author name is<span class="inner">Author 2</span></a>
    </li><li class="author">
      <h2 class="title">Title 3</h2>
      <a class="name" href="//3">The author name is<span class="inner">Author 3</span></a>
    </li>
  </ul>
</div>
</script>
<script type="test/fixture" id="test-38.html">
<div class="authors">
  <ul>
    <li class="author">
      <a class="name">The author name is<span class= "inner">Author 1</span></a>
    </li>
  </ul>
</div>

</script>
<script type="test/fixture" id="test-38.json">
{ "inner": "Author 1" }

</script>
<script type="test/fixture" id="test-38.out">
<div class="authors">
  <ul>
    <li class="author">
      <a class="name">The author name is<span class= "inner">Author 1</span></a>
    </li>
  </ul>
</div>

</script>
<script type="test/fixture" id="test-39.html">
<div class="row-fluid content">

  <div class="span4" role="complementary">
    <h2>Authors</h2>
    <div class="author"></div>
  </div>

</div>
</script>
<script type="test/fixture" id="test-39.json">
{
  "author":["ABC","DEF"]
}
</script>
<script type="test/fixture" id="test-39.out">
<div class="row-fluid content">

  <div class="span4" role="complementary">
    <h2>Authors</h2>
    <div class="author">ABC</div><div class="author">DEF</div>
  </div>

</div>
</script>
<script type="test/fixture" id="test-4.html">
<a id="someid" src="google.com"></a>
<a id="someotherid" src="yahoo.com"></a>
</script>
<script type="test/fixture" id="test-4.json">
{
  "key1": "Google",
  "key2": "Yahoo!"
}
</script>
<script type="test/fixture" id="test-4.out">
<a id="someid" src="google.com">Google</a>
<a id="someotherid" src="yahoo.com">Yahoo!</a>
</script>
<script type="test/fixture" id="test-40.html">
<ul>
  <li class="zero"></li>
  <li class="one"></li>
  <li class="banana"></li>
</ul>

</script>
<script type="test/fixture" id="test-40.json">
{
  "counts": {
    "zero": 0,
    "one": 1
  },
  "ringring": "bananaphone"
}

</script>
<script type="test/fixture" id="test-40.out">
<ul>
  <li class="zero">0</li>
  <li class="one">1</li>
  <li class="banana">bananaphone</li>
</ul>

</script>
<script type="test/fixture" id="test-41.html">
<form class="ssl">
  <fieldset>
    <input type="text">
    <textarea></textarea>
  </fieldset>
  <fieldset>
    <input type="text">
    <textarea></textarea>
  </fieldset>
  <fieldset>
    <input type="text">
    <textarea></textarea>
  </fieldset>
</form>
<form>
  <fieldset>
    <input type="text">
    <textarea></textarea>
  </fieldset>
</form>

</script>
<script type="test/fixture" id="test-41.json">
{}

</script>
<script type="test/fixture" id="test-41.out">

<form>
  <fieldset>
    <input type="text">
    <textarea></textarea>
  </fieldset>
</form>

</script>
<script type="test/fixture" id="test-42.html">
<div data-bind='key'></div>
</script>
<script type="test/fixture" id="test-42.json">
{
  "key": "value"
}

</script>
<script type="test/fixture" id="test-42.out">
<div data-bind='key'>value</div>
</script>
<script type="test/fixture" id="test-43.html">
<a data-bind-href="key">Value</a>
</script>
<script type="test/fixture" id="test-43.json">
{
  "key": "/bar"
}
</script>
<script type="test/fixture" id="test-43.out">
<a data-bind-href="key" href="/bar">Value</a>
</script>
<script type="test/fixture" id="test-44.html">
<div data-bind="key">Should not be changed</div>
</script>
<script type="test/fixture" id="test-44.json">
{}
</script>
<script type="test/fixture" id="test-44.out">
<div data-bind="key">Should not be changed</div>
</script>
<script type="test/fixture" id="test-45.html">
<li id="zero"></li>
</script>
<script type="test/fixture" id="test-45.json">
{
  "zero": 0
}
</script>
<script type="test/fixture" id="test-45.out">
<li id="zero">0</li>
</script>
<script type="test/fixture" id="test-46.html">
<li id="zero"></li>
<li class="test"></li>
</script>
<script type="test/fixture" id="test-46.json">
{
  "zero": 0,
  "one": 1
}
</script>
<script type="test/fixture" id="test-46.out">
<li id="zero">0</li>
<li class="test">1</li>
</script>
<script type="test/fixture" id="test-47.html">
<a data-bind-href="zero" data-bind-class="test" class="">link</a>
</script>
<script type="test/fixture" id="test-47.json">
{
  "zero": "/sub-zero",
  "one": "oneclass"
}
</script>
<script type="test/fixture" id="test-47.out">
<a data-bind-href="zero" data-bind-class="test" class="oneclass" href="/sub-zero">link</a>
</script>
<script type="test/fixture" id="test-48.html">
<a data-bind-href="zero" data-bind="test">link</a>
</script>
<script type="test/fixture" id="test-48.json">
{
  "zero": "/sub-zero",
  "one": "Super link"
}
</script>
<script type="test/fixture" id="test-48.out">
<a data-bind-href="zero" data-bind="test" href="/sub-zero">Super link</a>
</script>
<script type="test/fixture" id="test-49.html">
<a data-bind-href="zero" href="/some-link">link</a>
</script>
<script type="test/fixture" id="test-49.json">
{}
</script>
<script type="test/fixture" id="test-49.out">
<a data-bind-href="zero" href="/some-link">link</a>
</script>
<script type="test/fixture" id="test-5.html">
<a id="someid" class="red hidden large" href="/foo">Old Value</a>
</script>
<script type="test/fixture" id="test-5.json">
{
  "key1": "New Value"
}
</script>
<script type="test/fixture" id="test-5.out">
<a id="someid" class="red hidden large" href="/foo">New Value</a>
</script>
<script type="test/fixture" id="test-50.html">
<a data-bind="test">link</a>
</script>
<script type="test/fixture" id="test-50.json">
{
  "one": "Super link",
  "test": "Not wanted"
}
</script>
<script type="test/fixture" id="test-50.out">
<a data-bind="test">Super link</a>
</script>
<script type="test/fixture" id="test-6.html">
<a id="someid" class="red hidden large" href="/foo">Old Value</a>
</script>
<script type="test/fixture" id="test-6.json">
{
  "key1": "New Value",
  "key2": "/bar"
}
</script>
<script type="test/fixture" id="test-6.out">
<a id="someid" class="red hidden large" href="/bar">New Value</a>
</script>
<script type="test/fixture" id="test-7.html">
<a id="someid1" class="name" href="/foo"></a>
<a id="someid2" onclick="name" href="/foo"></a>
</script>
<script type="test/fixture" id="test-7.json">
{
  "name": "Alpha"
}
</script>
<script type="test/fixture" id="test-7.out">
<a id="someid1" class="name" href="/foo">Alpha</a>
<a id="someid2" onclick="name" href="/foo"></a>
</script>
<script type="test/fixture" id="test-8.html">
<a href="/"></a>
</script>
<script type="test/fixture" id="test-8.json">
{
  "newurl": "/test"
}
</script>
<script type="test/fixture" id="test-8.out">
<a href="/test"></a>
</script>
<script type="test/fixture" id="test-9.html">
<a href="/"></a>

</script>
<script type="test/fixture" id="test-9.json">
[
  { "url": "/a" },
  { "url": "/b" },
  { "url": "/c" }
]

</script>
<script type="test/fixture" id="test-9.out">
<a href="/a"></a>


<a href="/b"></a>


<a href="/c"></a>

</script>
<script>
var ws = "\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003" +
    "\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028" +
    "\u2029\uFEFF";
if (!String.prototype.trim || ws.trim()) {
    // http://blog.stevenlevithan.com/archives/faster-trim-javascript
    // http://perfectionkills.com/whitespace-deviations/
    ws = "[" + ws + "]";
    var trimBeginRegexp = new RegExp("^" + ws + ws + "*"),
        trimEndRegexp = new RegExp(ws + ws + "*$");
    String.prototype.trim = function trim() {
        if (this === undefined || this === null) {
            throw new TypeError("can't convert "+this+" to object");
        }
        return String(this).replace(trimBeginRegexp, "").replace(trimEndRegexp, "");
    };
}

var common = {
  createTest: function (name, map) {
    var html = document.getElementById(name + '.html').innerHTML
      , out = document.getElementById(name + '.out').innerHTML
      , data = JSON.parse(document.getElementById(name + '.json').innerHTML);

    var result = Plates.bind(html, data, map);

    QUnit.assert.equal(
        result.trim().replace(/[\n|\r]/g, '')
      , out.trim().replace(/[\n|\r]/g, '')
      , 'Expecting `' + html + '` to equal `' + out + '`'
    );
  }
}
module("merge data into markup, when providing both data and markup");

test("(1) a single tag with an `id` that corresponds to a `data-key`.", function () {
  return common.createTest('test-1');
});

test("(2) a deeply nested tag with an `id` that corresponds to a `data-key`.", function () {
  return common.createTest('test-2');
});

test("(3) a tag with an `id` that corresponds to a `data-key`, having a body of nested tags.", function () {
  return common.createTest('test-3');
});

test("(4) a tag with an arbitrary attribute that corresponds to a `data-key`.", function () {
  var map = Plates.Map();
  map.where('src').is('google.com').use('key1');
  map.where('src').is('yahoo.com').use('key2');

  return common.createTest('test-4', map);
});

test("(5) a tag with a class attribute whith a value that corresponds to a `data-key`.", function () {
  var map = Plates.Map();
  map.where('class').is('hidden').use('key1');

  return common.createTest('test-5', map);
});

test("(6) a tag with a class attribute whith a value that corresponds to a `data-key`, a second map item.", function () {
  var map = Plates.Map();
  map.where('class').is('hidden').use('key1');
  map.where('href').is('/foo').use('key2').as('href');

  return common.createTest('test-6', map);
});

test("(7) a map that redefines the default matching attribute of `id`.", function () {
  var map = Plates.Map({
    where: 'class'
  });

  return common.createTest('test-7', map);
});

test("(8) using the insert shortcut.", function () {
  var map = Plates.Map();
  map.where('href').is('/').insert('newurl');

  return common.createTest('test-8', map);
});

test("(9) iterate a collection.", function () {
  var map = Plates.Map();
  map.where('href').is('/').insert('url');

  return common.createTest('test-9', map);
});

test("(10) a map that defines creating missing attributes.", function () {
  var map = Plates.Map({
    create: true
  });

  map.className('logo').use('url').as('src');
  map.where('name').is('first_name').use('fname').as('value');
  map.where('name').is('last_name').use('lname').as('value');

  return common.createTest('test-10', map);
});

test("(11) differing on \"is\" parameter only.", function () {
  var map = Plates.Map();
  map.where('name').is('method').use('method').as('value');
  map.where('name').is('id').use('id').as('value');

  return common.createTest('test-11', map);
});

test("(12) iterate a collection of over an element with children.", function () {
  var map = Plates.Map({
    where: 'class'
  });

  return common.createTest('test-12', map);
});

test("(13) attributes can contain valid characters", function () {
  var map = Plates.Map();
  map.where('href').is('aA1-_:/&#1235; ').insert('test');

  return common.createTest('test-13', map);
});

test("(14) It should be able to iterate over collections with maps", function () {
  var map = Plates.Map();
  map.className("names").use("names");

  return common.createTest('test-14', map);
});

test("(15) It should be able to iterate over collections with multiple maps", function () {
  var map = Plates.Map();
  map.where("href").is("placeholder").insert("link");
  map.className("names").use("names");

  return common.createTest('test-15', map);
});

test("(16) It should be able to iterate over simple arrays", function () {
  var map = Plates.Map({
    where: 'class'
  });

  return common.createTest('test-16', map);
});

test("(17) It should be able to iterate over deeply nested objects", function () {
  var map = Plates.Map({
    where: 'class'
  });

  return common.createTest('test-17', map);
});

test("(18) It should be able to see the classnames properly", function () {
  var map = Plates.Map();
  map.className("username").use("username");
  map.className("name").use("name");

  return common.createTest('test-18', map);
});

test("(19) Replace partial value with a new value", function () {
  var map = Plates.Map();
  map.where("href").is(/^bar/).replace(/bar/, 'bazz');

  return common.createTest('test-19', map);
});

test("(20) Replace partial value with a new value from the data object", function () {
  var map = Plates.Map();
  map.where("href").has(/^bar/).insert('test');

  return common.createTest('test-20', map);
});

test("(21) Remove should remove the whole element", function () {
  var map = Plates.Map();
  map.className('removed').remove();

  return common.createTest('test-21', map);
});

test("(22) Remove should remove self closing elements", function () {
  var map = Plates.Map();
  map.where('type').is('email').remove();

  return common.createTest('test-22', map);
});

test("(23) Remove should remove self closing elements without optional ending slash", function () {
  var map = Plates.Map();
  map.where('type').is('email').remove();

  return common.createTest('test-23', map);
});

test("(24) Should append new templates", function () {
  var map = Plates.Map();
  map.className('insert').append('<div class="trolling"></div>');

  return common.createTest('test-24', map);
});

test("(25) New templates should also process map and custom data", function () {
  var map = Plates.Map();
  var partial = Plates.Map();

  partial.className('trolling').to('boink');
  map.className('insert').append('<div class="trolling"></div>', { boink: 'moo' }, partial);

  return common.createTest('test-25', map);
});

test("(26) When the data for the partial was provided as a string, get it from the parent data structure", function () {
  var map = Plates.Map();
  var partial = Plates.Map();

  partial.className('trolling').to('boink');
  map.className('insert').append('<div class="trolling"></div>', 'partial', partial);

  return common.createTest('test-26', map);
});

test("(27) append should read from file system if no template has been provided", function () {
  var map = Plates.Map();
  var partial = Plates.Map();

  map.className('insert').append('partial-1.html');

  return common.createTest('test-27', map);
});

test("(28) it should repeat the partial for each item in the array", function () {
  var map = Plates.Map();
  var partial = Plates.Map();

  map.className('insert').append('partial-1.html', [{}, {}, {}]);

  return common.createTest('test-28', map);
});
test("(29) a tag match without attributes should replace the contents", function () {
 var map = Plates.Map();
 map.tag('div').use('foo');

 return common.createTest('test-29', map);
});

test("(30) use can be passed a function which returns the value", function () {
  var map = Plates.Map();
  map.class('transformation').use(function (data, key) {
    return data.uppercase.toLowerCase();
  });

  return common.createTest('test-30', map);
});

test("(31) Two maps on the same class, one for attribute work if the attribute one comes last", function () {
  var map = Plates.Map();
  map.class('author').to('name');
  map.class('author').use('url').as('href');

  return common.createTest('test-31', map);
});

test("(32) Two maps on the same class, one for attribute work if the attribute one comes first", function () {
  var map = Plates.Map();
  map.class('author').use('url').as('href');
  map.class('doesnotexist').to('donotcare');
  map.class('author').to('name');

  return common.createTest('test-32', map);
});

test("(33) Two maps on the same attribute and value should throw", function () {
  var map = Plates.Map();
  var result = {};
  map.class('author').use('url').as('href');
  map.class('author').to('name');
  map.class('author').to('name');

  try {
    Plates.bind('<a></a>', {a:1}, map);
  } catch(err) {
    result.error = err;
  }

  QUnit.assert.ok(!! result.error, 'Should have thrown');
  QUnit.assert.equal(result.error.message, 'Conflicting mappings for attribute class and value author');
});

test("(34) Two maps for the same class, updating two attributes should update both attributes", function () {
  var map = Plates.Map();
  map.class('author').use('url').as('href');
  map.class('author').use('class').as('class');

  return common.createTest('test-34', map);
});

test("(35) Two maps for the same class, updating two attributes plus a body class map should update both attributes", function () {
  var map = Plates.Map();
  map.class('author').use('url').as('href');
  map.class('author').use('class').as('class');
  map.class('author').to('name');

  return common.createTest('test-35', map);
});

test("(36) complex nesting should work as expected", function () {
  var map = Plates.Map();
  map.class('author').use('author');
  map.class('name').use('name');
  map.class('name').use('link').as('href');
  map.class('title').use('title');
  map.class('inner').use('inner');

  return common.createTest('test-36', map);
});

test("(37) complex nesting with arrays should work as expected", function () {
  var map = Plates.Map();
  map.class('author').use('author');
  map.class('name').use('name');
  map.class('name').use('link').as('href');
  map.class('title').use('title');
  map.class('inner').use('inner');

  return common.createTest('test-37', map);
});

test("(38) spaces in attributes", function () {
  var map = Plates.Map();
  map.class('inner').use('inner');

  return common.createTest('test-38', map);
});

test("(39) Nesting arrays with objects with arrays should work", function () {
  var map = Plates.Map();

  map.className('author').to('author');

  return common.createTest('test-39', map);
});

test("(40) Nested objects can be accessed using dot notiation", function () {
  var map = Plates.Map();

  map.className('zero').to('counts.zero');
  map.className('one').to('counts.one');
  map.className('banana').to('ringring');

  return common.createTest('test-40', map);
});

test("(41) Should remove the correct element", function () {
  var map = Plates.Map();

  map.className('ssl').remove();

  return common.createTest('test-41', map);
});

test("(42) Support data-bind without mapping", function () {
  return common.createTest('test-42');
});

test("(43) Support data-bind-attr without mapping", function () {
  return common.createTest('test-43');
});

test("(44) Non matching data-bind should do nothing", function () {
  return common.createTest('test-44');
});

test("(45) Should allow the value of 0 in convention mapping case", function () {
  return common.createTest('test-45');
});

test("(46) Should allow mixing convention and configuration", function () {
  var map = Plates.Map();

  map.class('test').to('one');

  return common.createTest('test-46', map);
});

test("(47) Should allow mixing convention and configuration for attributes", function () {
  var map = Plates.Map();

  map.where('data-bind-class').is('test').use('one').as('class');

  return common.createTest('test-47', map);
});

test("(48) Should allow mixing convention (for an attribute) and configuration (for tag content)", function () {
  var map = Plates.Map();

  map.where('data-bind').is('test').use('one');

  return common.createTest('test-48', map);
});

test("(49) Should only set attribute (data-bind-attr) if data exists", function () {
  return common.createTest('test-49');
});

test("(50) Do not apply default mapping if explicit mapping is set", function () {
  var map = Plates.Map();

  map.where('data-bind').is('test').use(function (data, key) {
    return (data['one']);
  });

  return common.createTest('test-50', map);
});

</script>
